# MVP 해커톤 DB 스키마 (SQLite3)

본 문서는 **POSTGRESQL 기준**으로 작성된 DB 스키마 초안이다.  

---

## ENUM 타입
```sql
CREATE TYPE user_role AS ENUM ('MENTOR', 'MENTEE');
CREATE TYPE subject_type AS ENUM ('KOR', 'ENG', 'MATH', 'ETC');
CREATE TYPE task_status AS ENUM ('TODO', 'WORKING', 'DONE');
CREATE TYPE material_type AS ENUM ('COLUMN', 'PDF');
CREATE TYPE log_source AS ENUM ('MANUAL', 'TIMER');
```

## 1. users

```sql
CREATE TABLE users (
    id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    mentor_id INTEGER REFERENCES users(id),
    role user_role NOT NULL,
    name TEXT NOT NULL,
    created_at TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
    current_streak INTEGER NOT NULL DEFAULT 0,
    max_streak INTEGER NOT NULL DEFAULT 0,
    last_streak_date DATE
);
```
---

## 2. Subjects
```sql
CREATE TABLE subjects (
    id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    subject TEXT NOT NULL
);
```
---

## 3. daily_planner

```sql
CREATE TABLE daily_planner (
    id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    mentee_id INTEGER NOT NULL REFERENCES users(id),
    date DATE NOT NULL,
    header_note TEXT,
    created_at TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
    UNIQUE (mentee_id, date)
);
```

---

## 4. tasks

```sql
CREATE TABLE tasks (
    id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    mentee_id INTEGER NOT NULL REFERENCES users(id),
    date DATE NOT NULL,
    time TIME NOT NULL, -- 'HH:MM:SS' 형태
    subject subject_type NOT NULL,
    title TEXT NOT NULL,
    goal TEXT,
    is_fixed_by_mentor BOOLEAN NOT NULL DEFAULT FALSE,
    created_by INTEGER NOT NULL REFERENCES users(id),
    status task_status NOT NULL DEFAULT 'TODO',
    completed_at TIMESTAMPTZ,
    sort_order INTEGER,
    created_at TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP
);
```

---

## 5. task_time_logs

```sql
CREATE TABLE task_time_logs (
    id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    task_id INTEGER NOT NULL REFERENCES tasks(id) ON DELETE CASCADE,
    started_at TIMESTAMPTZ NOT NULL,
    ended_at TIMESTAMPTZ,
    duration_seconds INTEGER,
    source log_source,
    created_at TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP
);
```

---

## 6. task_materials

```sql
CREATE TABLE task_materials (
    id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    task_id INTEGER NOT NULL REFERENCES tasks(id) ON DELETE CASCADE,
    type material_type NOT NULL,
    title TEXT,
    content TEXT,
    file_url TEXT,
    uploaded_by INTEGER NOT NULL REFERENCES users(id),
    created_at TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP
);
```

---

## 7. task_submissions

```sql
CREATE TABLE task_submissions (
    id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    task_id INTEGER NOT NULL REFERENCES tasks(id) ON DELETE CASCADE,
    mentee_id INTEGER NOT NULL REFERENCES users(id),
    image_url TEXT NOT NULL,
    note TEXT,
    submitted_at TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP
);
```

---

## 8. feedbacks

```sql
CREATE TABLE feedbacks (
    id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    mentee_id INTEGER NOT NULL REFERENCES users(id),
    mentor_id INTEGER NOT NULL REFERENCES users(id),
    date DATE NOT NULL,
    subject subject_type NOT NULL,
    summary TEXT,
    body TEXT,
    overall_comment TEXT,
    created_at TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
    UNIQUE (mentee_id, date, subject)
);
```

---

## 9. calendar_events

```sql
CREATE TABLE calendar_events (
    id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    mentee_id INTEGER NOT NULL REFERENCES users(id),
    title TEXT NOT NULL,
    start_date DATE NOT NULL,
    end_date DATE,
    subject subject_type,
    description TEXT,
    created_by INTEGER NOT NULL REFERENCES users(id),
    created_at TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP
);
```

---

## 10. notifications

```sql
CREATE TABLE notifications (
    id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    user_id INTEGER NOT NULL REFERENCES users(id),
    type TEXT NOT NULL,
    title TEXT NOT NULL,
    body TEXT NOT NULL,
    payload_json JSONB,
    is_read BOOLEAN NOT NULL DEFAULT FALSE,
    sent_at TIMESTAMPTZ,
    created_at TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP
);
```
## 11. daily_statistics
```sql
CREATE TABLE daily_statistics (
    id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    user_id INTEGER NOT NULL REFERENCES users(id),
    date DATE NOT NULL,
    total_study_time INTEGER DEFAULT 0, -- 초 단위
    completed_tasks_count INTEGER DEFAULT 0,
    total_tasks_count INTEGER DEFAULT 0,
    achievement_rate INTEGER DEFAULT 0, -- (완료/전체) * 100
    UNIQUE(user_id, date)
);
```

---

~~### 참고~~
~~- 시간/날짜는 **ISO-8601 문자열(TEXT)** 로 저장~~
~~- SQLite에서는 BOOLEAN → INTEGER(0/1)~~
~~- MVP 이후 Postgres/MySQL로 이전 가능하도록 설계~~
